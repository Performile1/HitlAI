# HitlAI - System Architecture Diagram

**Version:** 1.0  
**Last Updated:** January 16, 2026

---

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              CLIENT LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          │
│  │  Marketing Site  │  │  Company Portal  │  │  Tester Portal   │          │
│  │  (Public Pages)  │  │  (Dashboard)     │  │  (Dashboard)     │          │
│  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘          │
│           │                     │                      │                     │
│           └─────────────────────┼──────────────────────┘                     │
│                                 │                                            │
│                    ┌────────────▼────────────┐                              │
│                    │   Next.js Frontend      │                              │
│                    │   - React Components    │                              │
│                    │   - TailwindCSS         │                              │
│                    │   - Client-side Logic   │                              │
│                    └────────────┬────────────┘                              │
└─────────────────────────────────┼───────────────────────────────────────────┘
                                  │
                                  │ HTTPS
                                  │
┌─────────────────────────────────▼───────────────────────────────────────────┐
│                           APPLICATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                        Next.js API Routes                              │  │
│  ├───────────────────────────────────────────────────────────────────────┤  │
│  │                                                                         │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │  │
│  │  │ Test Exec    │  │ Milestones   │  │ Applications │                │  │
│  │  │ /api/test    │  │ /api/        │  │ /api/early-  │                │  │
│  │  │              │  │ milestones   │  │ adopter      │                │  │
│  │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                │  │
│  │         │                 │                  │                         │  │
│  │  ┌──────▼───────┐  ┌──────▼───────┐  ┌──────▼───────┐                │  │
│  │  │ Training     │  │ Admin        │  │ Webhooks     │                │  │
│  │  │ /api/admin/  │  │ /api/admin   │  │ /api/        │                │  │
│  │  │ training     │  │              │  │ webhooks     │                │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                │  │
│  │                                                                         │  │
│  └─────────────────────────────────┬───────────────────────────────────────┘  │
│                                    │                                        │
└────────────────────────────────────┼────────────────────────────────────────┘
                                     │
                                     │
┌────────────────────────────────────▼────────────────────────────────────────┐
│                            ORCHESTRATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                      Test Orchestrator                                 │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Phase Detection → Model Selection → Execution → Result Merge  │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
│           ┌───────────────────┬───────────────────┐                         │
│           │                   │                   │                         │
│  ┌────────▼────────┐ ┌────────▼────────┐ ┌───────▼────────┐               │
│  │  AI Test Engine │ │ Human Test      │ │ Hybrid Engine  │               │
│  │                 │ │ Assignment      │ │                │               │
│  │  - Phase 1-4    │ │                 │ │ - AI + Human   │               │
│  │  - Model Router │ │ - Tester Match  │ │ - Voting       │               │
│  │  - Prompt Eng   │ │ - Queue Mgmt    │ │ - Consensus    │               │
│  └────────┬────────┘ └────────┬────────┘ └───────┬────────┘               │
│           │                   │                   │                         │
└───────────┼───────────────────┼───────────────────┼─────────────────────────┘
            │                   │                   │
            │                   │                   │
┌───────────▼───────────────────▼───────────────────▼─────────────────────────┐
│                              AI/ML LAYER                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         Phase 1: External APIs                       │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │    │
│  │  │ GPT-4o       │  │ Claude 3.5   │  │ GPT-4o-mini  │             │    │
│  │  │ (Primary)    │  │ (Fallback)   │  │ (Cheap)      │             │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    Phase 2: Fine-Tuned Models                        │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │    │
│  │  │ Issue        │  │ Strategy     │  │ Sentiment    │             │    │
│  │  │ Detector     │  │ Analyzer     │  │ Analyzer     │             │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   Phase 3: Self-Hosted Models                        │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │    │
│  │  │ LLaMA 3.1 8B │  │ Mixtral 8x7B │  │ Groq API     │             │    │
│  │  │ (Local)      │  │ (Local)      │  │ (Fast)       │             │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     Phase 4: Ensemble System                         │    │
│  │  ┌──────────────────────────────────────────────────────────────┐   │    │
│  │  │  Multi-Model Voting + Dynamic Routing + Confidence Scoring   │   │    │
│  │  └──────────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     │
┌────────────────────────────────────▼────────────────────────────────────────┐
│                              DATA LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                     Supabase (PostgreSQL + Auth)                       │  │
│  ├───────────────────────────────────────────────────────────────────────┤  │
│  │                                                                         │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │  │
│  │  │ companies    │  │ test_runs    │  │ human_testers│                │  │
│  │  │              │  │              │  │              │                │  │
│  │  │ - RLS        │  │ - JSONB      │  │ - RLS        │                │  │
│  │  │ - Policies   │  │ - Indexes    │  │ - Policies   │                │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                │  │
│  │                                                                         │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │  │
│  │  │ issues       │  │ milestones   │  │ applications │                │  │
│  │  │              │  │              │  │              │                │  │
│  │  │ - JSONB      │  │ - Progress   │  │ - Early      │                │  │
│  │  │ - Metadata   │  │ - Tracking   │  │   Adopter    │                │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                │  │
│  │                                                                         │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                        Supabase Storage                                │  │
│  │  - Screenshots                                                         │  │
│  │  - Test Reports (PDF)                                                 │  │
│  │  - Training Data                                                      │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     │
┌────────────────────────────────────▼────────────────────────────────────────┐
│                          EXTERNAL SERVICES                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ OpenAI API   │  │ Anthropic    │  │ Stripe       │  │ SendGrid     │   │
│  │              │  │ API          │  │ (Payments)   │  │ (Email)      │   │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ Groq API     │  │ Vercel       │  │ GitHub       │  │ Slack        │   │
│  │ (Phase 3)    │  │ (Hosting)    │  │ (CI/CD)      │  │ (Webhooks)   │   │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Diagram

```
┌─────────────┐
│   Company   │
│   Creates   │
│   Test      │
└──────┬──────┘
       │
       │ POST /api/test/execute
       │
       ▼
┌─────────────────────────────────────────────────────────────┐
│                    Test Orchestrator                         │
│                                                              │
│  1. Validate request                                        │
│  2. Check quota                                             │
│  3. Determine current phase                                 │
│  4. Select execution strategy                               │
└──────┬──────────────────────────────────────────────────────┘
       │
       ├─────────────────┬─────────────────┬─────────────────┐
       │                 │                 │                 │
       ▼                 ▼                 ▼                 ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│   AI Only   │   │ Human Only  │   │   Hybrid    │   │   Phase 4   │
│   ($5)      │   │   ($25)     │   │   ($30)     │   │  Ensemble   │
└──────┬──────┘   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
       │                 │                 │                 │
       │                 │                 │                 │
       ▼                 ▼                 ▼                 ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│ AI Models   │   │ Assign to   │   │ AI + Human  │   │ Multi-Model │
│ Execute     │   │ Tester      │   │ Parallel    │   │ Voting      │
└──────┬──────┘   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
       │                 │                 │                 │
       │                 │                 │                 │
       ▼                 ▼                 ▼                 ▼
┌─────────────────────────────────────────────────────────────┐
│                   Store Results in DB                        │
│                                                              │
│  - test_runs table                                          │
│  - issues table                                             │
│  - Update milestones                                        │
│  - Capture training data (if rated 4+)                     │
└──────┬──────────────────────────────────────────────────────┘
       │
       │
       ▼
┌─────────────────────────────────────────────────────────────┐
│                   Return Results to Company                  │
│                                                              │
│  - Sentiment score                                          │
│  - Issues found                                             │
│  - Recommendations                                          │
│  - Positives                                                │
└─────────────────────────────────────────────────────────────┘
```

---

## Progressive Unlock Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Milestone Tracking                                │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
                    ┌─────────────────────────┐
                    │   Phase 1: Active       │
                    │   Cost: $5/test         │
                    │   Models: GPT-4o        │
                    └───────────┬─────────────┘
                                │
                                │ 1,000 tests completed
                                ▼
                    ┌─────────────────────────┐
                    │   Phase 2: Unlocked     │
                    │   Cost: $3/test (40% ↓) │
                    │   Models: Fine-tuned    │
                    └───────────┬─────────────┘
                                │
                                │ 5,000 tests completed
                                ▼
                    ┌─────────────────────────┐
                    │   Phase 3: Unlocked     │
                    │   Cost: $1.50/test (70% ↓)│
                    │   Models: Self-hosted   │
                    └───────────┬─────────────┘
                                │
                                │ 10,000 tests completed
                                ▼
                    ┌─────────────────────────┐
                    │   Phase 4: Unlocked     │
                    │   Cost: $1/test (80% ↓) │
                    │   Models: Ensemble      │
                    └─────────────────────────┘
```

---

## Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Security Layers                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  Layer 1: Authentication                                                 │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ Supabase Auth (JWT)                                               │  │
│  │ - Email/Password                                                  │  │
│  │ - Session management                                              │  │
│  │ - Token refresh                                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  Layer 2: Authorization (RLS)                                            │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ Row-Level Security Policies                                       │  │
│  │ - Companies see only their data                                   │  │
│  │ - Testers see only assigned tests                                 │  │
│  │ - Admins see everything                                           │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  Layer 3: API Security                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ - Rate limiting                                                   │  │
│  │ - Input validation                                                │  │
│  │ - CORS policies                                                   │  │
│  │ - API key rotation                                                │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  Layer 4: Data Encryption                                                │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ - HTTPS/TLS                                                       │  │
│  │ - Database encryption at rest                                     │  │
│  │ - Encrypted environment variables                                 │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Production Environment                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                        Vercel Edge Network                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │  │
│  │  │   US East   │  │   US West   │  │   Europe    │              │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘              │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                │                                         │
│                                ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Next.js Application                             │  │
│  │  - Server-side rendering                                          │  │
│  │  - API routes                                                     │  │
│  │  - Static generation                                              │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                │                                         │
│                                ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Supabase Cloud                                  │  │
│  │  - PostgreSQL database                                            │  │
│  │  - Authentication                                                 │  │
│  │  - Storage                                                        │  │
│  │  - Real-time subscriptions                                        │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

**End of Architecture Diagram**
